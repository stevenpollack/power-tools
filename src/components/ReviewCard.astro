---
import { Image } from "astro:assets";

interface Props {
  reviewId: string;
  dateCreated: string;
  excerpt: string;
  toolBrand: string;
  toolName: string;
  toolImage?: any;
  authorName: string;
  mood: "humorous" | "dramatic" | "technical" | "philosophical";
  tone: "formal" | "casual" | "satirical" | "earnest";
  readingTime: number;
}

const {
  reviewId,
  dateCreated,
  excerpt,
  toolBrand,
  toolName,
  toolImage,
  authorName,
  mood,
  tone,
  readingTime,
} = Astro.props;

// Brand color mapping
const brandColors = {
  milwaukee: "#E31E24",
  ryobi: "#6ABE45",
  dewalt: "#FFD320",
  dremel: "#0066CC",
  paslode: "#FF4500",
  ozito: "#FF6600",
  makita: "#00B2CC",
  bosch: "#007BC1",
};

const brandColor =
  brandColors[toolBrand.toLowerCase() as keyof typeof brandColors] || "#6B7280";

// Mood/Tone badge styling
const moodStyles = {
  philosophical: "bg-indigo-100 text-indigo-800 border-indigo-200",
  technical: "bg-green-100 text-green-800 border-green-200",
  humorous: "bg-yellow-100 text-yellow-800 border-yellow-200",
  dramatic: "bg-red-100 text-red-800 border-red-200",
};

const toneStyles = {
  formal: "bg-slate-100 text-slate-700 border-slate-200",
  casual: "bg-emerald-100 text-emerald-700 border-emerald-200",
  satirical: "bg-orange-100 text-orange-700 border-orange-200",
  earnest: "bg-purple-100 text-purple-700 border-purple-200",
};

// Format date to relative time
function formatRelativeTime(dateString: string): string {
  const date = new Date(dateString);
  const now = new Date();
  const diffInMs = now.getTime() - date.getTime();
  const diffInDays = Math.floor(diffInMs / (1000 * 60 * 60 * 24));

  if (diffInDays === 0) return "Today";
  if (diffInDays === 1) return "1 day ago";
  if (diffInDays < 7) return `${diffInDays} days ago`;
  if (diffInDays < 14) return "1 week ago";
  if (diffInDays < 30) return `${Math.floor(diffInDays / 7)} weeks ago`;
  if (diffInDays < 60) return "1 month ago";
  return `${Math.floor(diffInDays / 30)} months ago`;
}

const relativeTime = formatRelativeTime(dateCreated);
const reviewUrl = `/review/${reviewId}`;
---

<a href={reviewUrl} class="review-card group block">
  <div
    class="bg-card flex h-full flex-col rounded-xl border p-6 shadow-sm transition-all duration-300 hover:-translate-y-1 hover:shadow-xl"
  >
    <!-- Tool Image -->
    <div class="mb-4 flex items-center gap-4">
      <div class="h-16 w-16 flex-shrink-0 overflow-hidden rounded-lg border">
        {
          toolImage ? (
            <Image
              src={toolImage}
              alt={`${toolBrand} ${toolName}`}
              width={64}
              height={64}
              class="h-full w-full object-cover"
            />
          ) : (
            <div
              class="flex h-full w-full items-center justify-center text-sm font-bold text-white"
              style={`background-color: ${brandColor}`}
            >
              {toolBrand.slice(0, 2).toUpperCase()}
            </div>
          )
        }
      </div>

      <div class="min-w-0 flex-1">
        <h3
          class="text-card-foreground group-hover:text-primary line-clamp-1 font-semibold transition-colors"
        >
          {toolName}
        </h3>
        <p class="text-muted-foreground text-sm">{toolBrand}</p>
      </div>
    </div>

    <!-- Badges -->
    <div class="mb-3 flex flex-wrap gap-2">
      <span
        class={`inline-flex items-center px-2 py-1 rounded-md text-xs font-medium border ${moodStyles[mood]}`}
      >
        {mood}
      </span>
      <span
        class={`inline-flex items-center px-2 py-1 rounded-md text-xs font-medium border ${toneStyles[tone]}`}
      >
        {tone}
      </span>
    </div>

    <!-- Excerpt -->
    <p class="text-muted-foreground mb-4 line-clamp-3 flex-1 text-sm">
      {excerpt}
    </p>

    <!-- Footer -->
    <div
      class="text-muted-foreground mt-auto flex items-center justify-between border-t pt-3 text-xs"
    >
      <div class="flex items-center gap-3">
        <span>by {authorName}</span>
        <span>{readingTime} min read</span>
      </div>
      <span>{relativeTime}</span>
    </div>
  </div>
</a>

<style>
  .line-clamp-1 {
    display: -webkit-box;
    -webkit-line-clamp: 1;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .review-card:hover .group-hover\:text-primary {
    color: oklch(47.8% 0.13 231.08);
  }
</style>
